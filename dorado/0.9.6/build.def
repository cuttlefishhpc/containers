Bootstrap: docker
From: ubuntu:22.04

%labels
    Author "Andrew S. Tupper, PhD"
    Version "1.0"
    Description "Container for running dorado 0.9.6"
    Maintainer "Andrew S. Tupper <tuppera@uncw.edu>"
    License "MIT"

%post
    set -e

    echo "Installing minimal dependencies"
    export DEBIAN_FRONTEND=noninteractive
    apt-get update && apt-get install -y --no-install-recommends \
        wget \
        tar \
        ca-certificates

    echo "Creating installation directory"
    mkdir -p /opt/dorado
    cd /opt/dorado

    echo "Downloading Dorado"
    wget https://cdn.oxfordnanoportal.com/software/analysis/dorado-0.9.6-linux-x64.tar.gz

    echo "Extracting Dorado"
    tar -xvzf dorado-0.9.6-linux-x64.tar.gz
    rm dorado-0.9.6-linux-x64.tar.gz

    echo "Cleaning up"
    apt-get clean && rm -rf /var/lib/apt/lists/*

    echo "Caching the help menu"
    mkdir -p /opt
    (/opt/dorado/dorado-0.9.6-linux-x64/bin/dorado 2>&1) > /opt/.help_menu.txt || true

%runscript
    if [ $# -eq 0 ]; then
        exec cat /opt/.help_menu.txt
    else
        exec /opt/dorado/dorado-0.9.6-linux-x64/bin/dorado "$@"
    fi
